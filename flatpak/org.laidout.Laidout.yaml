app-id: org.laidout.Laidout.yaml
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: laidout
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig
modules:

  - name: glu
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://mesa.freedesktop.org/archive/glu/glu-9.0.1.tar.xz
        sha256: fb5a4c2dd6ba6d1c21ab7c05129b0769544e1d68e1e3b0ffecb18e73c93055bc

  - name: ftgl
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/ftgl/FTGL%20Source/2.1.3%7Erc5/ftgl-2.1.3-rc5.tar.bz2
        sha256: 521ff7bd62c459ff5372e269c223e2a6107a6a99a36afdc2ae634a973af70c59

  - name: imlib2
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/enlightenment/imlib2-src/1.7.0/imlib2-1.7.0.tar.bz2
        sha256: 1976ca3db48cbae79cd0fc737dabe39cc81494fc2560e1d22821e7dc9c22b37d

  - name: GraphicsMagick
    config-opts:
      - --enable-shared
      - --disable-static
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/graphicsmagick/graphicsmagick/1.3.35/GraphicsMagick-1.3.35.tar.xz
        sha256: 188a8d6108fea87a0208723e8d206ec1d4d7299022be8ce5d0a9720509250250

  - name: babl
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gimp.org/pub/babl/0.1/babl-0.1.82.tar.xz
        sha256: c62d93d4ad6774cb8e3231bbbc7f2e61e551e7242d78640d757505ee1a9fadc5

  - name: gegl
    config-opts:
      - --without-libavformat
    build-options:
      cflags: -fcommon
      cxxflags: -fcommon
    sources:
      - type: archive
        url: https://download.gimp.org/pub/gegl/0.3/gegl-0.3.34.tar.bz2
        sha256: 5ca2227655ebf1ab2e252cee3eede219c758336394288ef301b93264b9411304

  - name: laidout
    buildsystem: simple
    build-options:
      cxxflags: -I/app/include/GraphicsMagick
    build-commands:
      - ./configure --prefix=/app
                    --relocatable
                    --laxkit=`pwd`/laxkit/lax
                    --extra-cppflags '-DLAX_LISTS_SOURCE_TOO'
      - make hidegarbage
      - make -j $FLATPAK_BUILDER_N_JOBS
      - pushd src/icons
      - make all-with-lax
      - popd
      - make install
      - install -Dm644 src/icons/laidout.svg /app/share/icons/hicolor/scalable/apps/org.laidout.Laidout.svg
      - install -Dm644 deb/laidout.desktop /app/share/applications/org.laidout.Laidout.desktop
      - desktop-file-edit --set-icon org.laidout.Laidout /app/share/applications/org.laidout.Laidout.desktop
    sources:
      - type: git
        dest: laxkit
        url: https://github.com/Laidout/laxkit.git
        branch: master
      - type: git
        url: https://github.com/Laidout/laidout.git
        branch: master
